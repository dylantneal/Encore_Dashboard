<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Debug Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        .debug-output {
            background: #2d2d44;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .test-form {
            background: #3d3d5a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
        }
        .success { color: #51cf66; }
        .error { color: #ff6b6b; }
        .warning { color: #ffd43b; }
    </style>
</head>
<body>
    <h1>üîí Authentication Debug Test</h1>
    
    <div class="debug-output" id="configStatus">Loading configuration...</div>
    
    <div class="test-form">
        <h3>Test Authentication</h3>
        <form id="testForm">
            <input type="password" id="testPassword" placeholder="Enter password" value="dashboard123">
            <button type="submit">Test Login</button>
        </form>
        <div class="debug-output" id="testResults"></div>
    </div>
    
    <div class="debug-output" id="debugLog"></div>

    <!-- Load config first -->
    <script>
        let configLoaded = false;
        
        function log(message, type = 'info') {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            debugLog.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            console.log(message);
        }
        
        function updateConfigStatus() {
            const statusDiv = document.getElementById('configStatus');
            if (window.CONFIG_LOADED) {
                statusDiv.innerHTML = `‚úÖ Config Status: LOADED
üìÅ Config Source: ${window.CONFIG_SOURCE || 'unknown'}
üîß DASHBOARD_CONFIG exists: ${!!window.DASHBOARD_CONFIG}
üîí Authentication config: ${JSON.stringify(window.DASHBOARD_CONFIG?.authentication, null, 2)}`;
                statusDiv.className = 'debug-output success';
            } else {
                statusDiv.innerHTML = '‚è≥ Config Status: LOADING...';
                statusDiv.className = 'debug-output warning';
            }
        }
        
        // Enhanced config loading with better error handling
        window.CONFIG_LOADED = false;
        
        function loadConfig() {
            return new Promise((resolve, reject) => {
                log('üîß Starting config load...');
                
                // Try to load config.js first
                const configScript = document.createElement('script');
                configScript.src = 'config.js?' + Date.now(); // Cache busting
                
                configScript.onload = function() {
                    log('‚úÖ config.js loaded successfully', 'success');
                    window.CONFIG_LOADED = true;
                    window.CONFIG_SOURCE = 'config.js';
                    updateConfigStatus();
                    resolve('config.js');
                };
                
                configScript.onerror = function() {
                    log('‚ö†Ô∏è config.js not found, trying config.example.js', 'warning');
                    // Remove failed script
                    document.head.removeChild(configScript);
                    
                    // Load fallback
                    const fallbackScript = document.createElement('script');
                    fallbackScript.src = 'config.example.js?' + Date.now(); // Cache busting
                    
                    fallbackScript.onload = function() {
                        log('‚úÖ config.example.js loaded successfully', 'success');
                        window.CONFIG_LOADED = true;
                        window.CONFIG_SOURCE = 'config.example.js';
                        updateConfigStatus();
                        resolve('config.example.js');
                    };
                    
                    fallbackScript.onerror = function() {
                        log('‚ùå Failed to load any config file', 'error');
                        window.CONFIG_LOADED = true; // Continue anyway
                        window.CONFIG_SOURCE = 'none';
                        updateConfigStatus();
                        reject('No config file found');
                    };
                    
                    document.head.appendChild(fallbackScript);
                };
                
                document.head.appendChild(configScript);
            });
        }
        
        function testAuthentication(password) {
            log('üîí Testing authentication...');
            
            if (!window.CONFIG_LOADED) {
                log('‚ùå Config not loaded yet!', 'error');
                return false;
            }
            
            const authConfig = window.DASHBOARD_CONFIG?.authentication;
            
            log(`üîß Auth config: ${JSON.stringify(authConfig)}`);
            log(`üîë Entered password: "${password}"`);
            log(`üîë Expected password: "${authConfig?.password}"`);
            log(`‚úÖ Enabled: ${authConfig?.enabled}`);
            log(`üéØ Match: ${password === authConfig?.password}`);
            
            if (!authConfig || !authConfig.enabled) {
                log('üîì Authentication disabled', 'warning');
                return true;
            }
            
            if (password === authConfig.password) {
                log('‚úÖ Authentication successful!', 'success');
                return true;
            } else {
                log('‚ùå Authentication failed!', 'error');
                return false;
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateConfigStatus();
            
            // Load config
            loadConfig().then(configFile => {
                log(`üîß Configuration loaded from: ${configFile}`, 'success');
            }).catch(error => {
                log(`üîß Configuration loading failed: ${error}`, 'error');
            });
            
            // Set up test form
            document.getElementById('testForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const password = document.getElementById('testPassword').value;
                const result = testAuthentication(password);
                
                const resultsDiv = document.getElementById('testResults');
                if (result) {
                    resultsDiv.innerHTML = '‚úÖ Authentication test PASSED';
                    resultsDiv.className = 'debug-output success';
                } else {
                    resultsDiv.innerHTML = '‚ùå Authentication test FAILED';
                    resultsDiv.className = 'debug-output error';
                }
            });
        });
        
        // Update status every second
        setInterval(updateConfigStatus, 1000);
    </script>
</body>
</html>